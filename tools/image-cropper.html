<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Free Online Image Cropper - Crop JPG, PNG & WEBP - NexaTools</title>
    
    <!-- ========= High SEO Meta Tags ========= -->
    <meta name="description" content="Crop your images to the perfect size with our free online tool. Easily crop JPG, PNG, and WEBP files with custom aspect ratios. Secure and client-side.">
    <meta name="keywords" content="image cropper, crop image, online image cropper, photo cropper, crop jpg, crop png, free cropper tool, aspect ratio, nexatools">
    <link rel="canonical" href="https://www.nexatools.pro/image-cropper.html">
    <meta name="robots" content="index, follow">
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://www.nexatools.pro/image-cropper.html">
    <meta property="og:title" content="Free Online Image Cropper - Crop JPG, PNG & WEBP - NexaTools">
    <meta property="og:description" content="Crop your images to the perfect size with our free online tool. Easily crop JPG, PNG, and WEBP files with custom aspect ratios. Secure and client-side.">
    <meta property="og:image" content="https://www.nexatools.pro/assets/images/og-image-cropper.png"> <!-- Create and host a relevant image for social sharing -->
    <meta property="og:site_name" content="NexaTools">
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://www.nexatools.pro/image-cropper.html">
    <meta property="twitter:title" content="Free Online Image Cropper - Crop JPG, PNG & WEBP - NexaTools">
    <meta property="twitter:description" content="Crop your images to the perfect size with our free online tool. Easily crop JPG, PNG, and WEBP files with custom aspect ratios. Secure and client-side.">
    <meta property="twitter:image" content="https://www.nexatools.pro/assets/images/og-image-cropper.png"> <!-- Use the same image as OG -->
    
    <!-- ========= Favicon ========= -->
    <link rel="icon" href="/assets/images/favicon.ico" sizes="any">
    <link rel="icon" href="/assets/images/favicon.svg" type="image/svg+xml">
    <link rel="apple-touch-icon" href="/assets/images/apple-touch-icon.png">
    <link rel="manifest" href="/assets/site.webmanifest">

    <!-- Cropper.js for the cropping functionality -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>

    <!-- ========= JSON-LD Schema Markup ========= -->
    <script type="application/ld+json">
    [
      {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "Image Cropper",
        "description": "A free, client-side online tool to crop images. Supports various aspect ratios, transformations like rotate and flip, and multiple output formats including JPG, PNG, and WEBP.",
        "url": "https://www.nexatools.pro/image-cropper.html",
        "applicationCategory": "MultimediaApplication",
        "operatingSystem": "Web",
        "offers": {
          "@type": "Offer",
          "price": "0",
          "priceCurrency": "USD"
        },
        "creator": {
            "@type": "Organization",
            "url": "https://www.nexatools.pro",
            "name": "NexaTools",
            "logo": "https://www.nexatools.pro/assets/images/logo.png"
        }
      },
      {
        "@context": "https://schema.org",
        "@type": "FAQPage",
        "mainEntity": [
          {
            "@type": "Question",
            "name": "How does the image cropper work?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "Our Image Cropper uses the popular Cropper.js library to perform all operations directly in your web browser. When you select an image, it's loaded into the tool but never leaves your computer. You can then adjust the crop box and download the result. Your files are never sent to a server."
            }
          },
          {
            "@type": "Question",
            "name": "Is it safe to use my personal images here?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "Yes, it is completely safe. Since the entire cropping process happens on your computer (client-side), your images are never uploaded to our servers. Your privacy is fully protected."
            }
          },
          {
            "@type": "Question",
            "name": "What are aspect ratios like 16:9 or 1:1?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "An aspect ratio describes the proportional relationship between an image's width and its height. For example, a 1:1 ratio is a perfect square, while 16:9 is a standard widescreen format used for videos and presentations. Using these presets helps you crop your image to fit specific requirements perfectly."
            }
          },
          {
            "@type": "Question",
            "name": "How do I download the cropped image?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "After you are happy with the crop area, select your desired output format (JPG, PNG, or WEBP) and quality. Then, simply click the 'Crop & Download Image' button. The cropped image will be generated and downloaded directly to your computer."
            }
          }
        ]
      }
    ]
    </script>

    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .header-scrolled {
            background-color: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        }
        .dark .header-scrolled {
            background-color: rgba(15, 23, 42, 0.8);
        }
        .drag-over {
            border-color: #3b82f6;
            background-color: rgb(59 130 246 / 0.05);
        }
        .dark .drag-over {
            background-color: rgb(59 130 246 / 0.1);
        }
        .cropper-view-box, .cropper-face {
            outline-color: #3b82f6; /* brand-blue */
        }
        .cropper-line {
            background-color: #3b82f6;
        }
        .cropper-point {
            background-color: #3b82f6;
        }
    </style>
    <script>
        if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark')
        } else {
            document.documentElement.classList.remove('dark')
        }

        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        brand: {
                            blue: '#3b82f6',
                            green: '#10b981',
                        }
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-slate-50 dark:bg-slate-900 text-slate-800 dark:text-slate-200 transition-colors duration-300 flex flex-col min-h-screen">

    <!-- =========== HEADER =========== -->
    <header id="header" class="fixed top-0 left-0 right-0 z-50 transition-all duration-300">
        <div class="container mx-auto px-4 py-4 flex justify-between items-center">
            <a href="/index.html" class="text-2xl font-bold text-slate-900 dark:text-white">Nexa<span class="text-brand-blue">Tools</span></a>
            <nav class="hidden md:flex items-center space-x-8">
                <a href="/index.html" class="text-slate-600 dark:text-slate-300 hover:text-brand-blue dark:hover:text-brand-blue transition-colors">Home</a>
                <a href="/index.html#tools" class="text-brand-blue font-semibold">Tools</a>
                <a href="/about-us.html" class="text-slate-600 dark:text-slate-300 hover:text-brand-blue dark:hover:text-brand-blue transition-colors">About</a>
                <a href="/contact-us.html" class="text-slate-600 dark:text-slate-300 hover:text-brand-blue dark:hover:text-brand-blue transition-colors">Contact</a>
            </nav>
            <div class="flex items-center">
                <button id="theme-toggle" class="p-2 rounded-full hover:bg-slate-200 dark:hover:bg-slate-700 transition-colors">
                    <svg id="theme-toggle-dark-icon" class="hidden h-5 w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg>
                    <svg id="theme-toggle-light-icon" class="hidden h-5 w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 5.05A1 1 0 003.636 6.464l.707.707a1 1 0 001.414-1.414l-.707-.707zM3 11a1 1 0 100-2H2a1 1 0 100 2h1zM6.464 16.364l.707-.707a1 1 0 00-1.414-1.414l-.707.707a1 1 0 001.414 1.414z" fill-rule="evenodd" clip-rule="evenodd"></path></svg>
                </button>
            </div>
        </div>
    </header>

    <main class="flex-grow pt-24 pb-12">
        <div class="container mx-auto px-4">
            <!-- Tool Header -->
            <div class="text-center mb-12">
                <h1 class="text-4xl md:text-5xl font-extrabold text-slate-900 dark:text-white flex items-center justify-center gap-4">
                    <span class="text-brand-blue">
                       <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-12 h-12"><path stroke-linecap="round" stroke-linejoin="round" d="M7.5 3.75H6A2.25 2.25 0 003.75 6v1.5M16.5 3.75H18A2.25 2.25 0 0120.25 6v1.5m0 9V18A2.25 2.25 0 0118 20.25h-1.5m-9 0H6A2.25 2.25 0 013.75 18v-1.5" /></svg>
                    </span>
                    Image Cropper
                </h1>
                <p class="mt-4 text-lg md:text-xl max-w-2xl mx-auto text-slate-600 dark:text-slate-300">Crop images to the perfect size with our easy-to-use tool.</p>
            </div>
            
            <!-- Tool UI -->
            <div id="upload-section" class="max-w-4xl mx-auto bg-white dark:bg-slate-800 rounded-xl shadow-lg p-6 md:p-8">
                <div id="drop-zone" class="border-2 border-dashed border-slate-300 dark:border-slate-600 rounded-lg p-8 text-center cursor-pointer transition-all duration-300">
                    <div class="flex flex-col items-center justify-center space-y-4 text-slate-500 dark:text-slate-400">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1"><path stroke-linecap="round" stroke-linejoin="round" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" /></svg>
                        <p class="text-lg font-semibold">Drag & drop an image here</p>
                        <p>or</p>
                        <button id="select-file-btn" class="bg-brand-blue text-white font-bold py-2 px-6 rounded-lg shadow-md hover:bg-blue-600 transition-colors">Select Image</button>
                        <input type="file" id="file-input" class="hidden" accept="image/*">
                    </div>
                </div>
            </div>

            <!-- Cropper UI (hidden by default) -->
            <div id="cropper-section" class="hidden">
                 <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <!-- Main Image Area -->
                    <div class="lg:col-span-2 bg-slate-200 dark:bg-slate-800 rounded-lg p-4">
                        <div class="max-w-full h-[500px]">
                            <img id="image-to-crop" src="" alt="Image to crop">
                        </div>
                    </div>

                    <!-- Controls Area -->
                    <div class="lg:col-span-1 space-y-6">
                        <!-- Preview -->
                        <div class="bg-white dark:bg-slate-800 p-4 rounded-xl shadow-lg">
                            <h3 class="font-bold mb-2">Preview</h3>
                            <div class="preview-box w-full h-48 overflow-hidden rounded-md bg-slate-100 dark:bg-slate-700"></div>
                        </div>
                        <!-- Actions -->
                        <div class="bg-white dark:bg-slate-800 p-4 rounded-xl shadow-lg space-y-4">
                             <div>
                                <h3 class="font-bold mb-2">Aspect Ratio</h3>
                                <div id="aspect-ratio-btns" class="grid grid-cols-2 sm:grid-cols-4 lg:grid-cols-2 gap-2 text-sm">
                                    <button data-ratio="NaN" class="bg-slate-200 dark:bg-slate-700 py-2 rounded-md hover:bg-brand-blue hover:text-white">Free</button>
                                    <button data-ratio="1" class="bg-slate-200 dark:bg-slate-700 py-2 rounded-md hover:bg-brand-blue hover:text-white">1:1</button>
                                    <button data-ratio="1.33333" class="bg-slate-200 dark:bg-slate-700 py-2 rounded-md hover:bg-brand-blue hover:text-white">4:3</button>
                                    <button data-ratio="1.77777" class="bg-slate-200 dark:bg-slate-700 py-2 rounded-md hover:bg-brand-blue hover:text-white">16:9</button>
                                </div>
                             </div>
                             <div>
                                <h3 class="font-bold mb-2">Transform</h3>
                                <div id="transform-btns" class="grid grid-cols-2 gap-2 text-sm">
                                    <button id="zoom-in-btn" class="bg-slate-200 dark:bg-slate-700 py-2 rounded-md hover:bg-slate-300 dark:hover:bg-slate-600 flex items-center justify-center gap-1">Zoom In</button>
                                    <button id="zoom-out-btn" class="bg-slate-200 dark:bg-slate-700 py-2 rounded-md hover:bg-slate-300 dark:hover:bg-slate-600 flex items-center justify-center gap-1">Zoom Out</button>
                                    <button id="rotate-left-btn" class="bg-slate-200 dark:bg-slate-700 py-2 rounded-md hover:bg-slate-300 dark:hover:bg-slate-600 flex items-center justify-center gap-1">Rotate -90°</button>
                                    <button id="rotate-right-btn" class="bg-slate-200 dark:bg-slate-700 py-2 rounded-md hover:bg-slate-300 dark:hover:bg-slate-600 flex items-center justify-center gap-1">Rotate +90°</button>
                                    <button id="flip-h-btn" class="bg-slate-200 dark:bg-slate-700 py-2 rounded-md hover:bg-slate-300 dark:hover:bg-slate-600 flex items-center justify-center gap-1">Flip H</button>
                                    <button id="flip-v-btn" class="bg-slate-200 dark:bg-slate-700 py-2 rounded-md hover:bg-slate-300 dark:hover:bg-slate-600 flex items-center justify-center gap-1">Flip V</button>
                                </div>
                             </div>
                        </div>

                        <!-- Output -->
                         <div class="bg-white dark:bg-slate-800 p-4 rounded-xl shadow-lg space-y-4">
                            <div>
                                <label for="format-select" class="block text-sm font-medium mb-1">Output format:</label>
                                <select id="format-select" class="w-full bg-slate-100 dark:bg-slate-700 border-slate-300 dark:border-slate-600 rounded-md shadow-sm focus:ring-brand-blue focus:border-brand-blue">
                                    <option value="png">PNG</option>
                                    <option value="jpg" selected>JPG</option>
                                    <option value="webp">WEBP</option>
                                </select>
                            </div>
                            <div id="quality-control">
                                <label for="quality-slider" class="block text-sm font-medium mb-1">Quality: <span id="quality-value">90</span>%</label>
                                <input id="quality-slider" type="range" min="1" max="100" value="90" class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer dark:bg-slate-600">
                            </div>
                         </div>
                        <button id="crop-btn" class="w-full bg-brand-green text-white font-bold py-3 px-6 rounded-lg shadow-md hover:bg-green-600 transition-colors">
                            Crop & Download Image
                        </button>
                         <button id="reset-btn" class="w-full bg-slate-500 text-white font-bold py-2 px-6 rounded-lg shadow-md hover:bg-slate-600 transition-colors">
                            Upload New Image
                        </button>
                    </div>
                 </div>
            </div>
        </div>
    </main>

    <!-- =========== NEW: FAQ Section =========== -->
    <section class="py-16 bg-slate-100 dark:bg-slate-900">
        <div class="container mx-auto px-4">
            <div class="max-w-3xl mx-auto">
                <h2 class="text-3xl font-bold text-center mb-8 text-slate-900 dark:text-white">Frequently Asked Questions</h2>
                <div class="space-y-4">
                    <!-- FAQ Item 1 -->
                    <details class="group bg-white dark:bg-slate-800 p-6 rounded-lg cursor-pointer shadow-sm">
                        <summary class="flex justify-between items-center font-semibold text-slate-800 dark:text-slate-100 list-none">
                            How does the image cropper work?
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 transition-transform duration-300 group-open:rotate-180" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" /></svg>
                        </summary>
                        <div class="mt-4 text-slate-600 dark:text-slate-400">
                            <p>Our Image Cropper uses the popular Cropper.js library to perform all operations directly in your web browser. When you select an image, it's loaded into the tool but never leaves your computer. You can then adjust the crop box and download the result. Your files are never sent to a server.</p>
                        </div>
                    </details>
                    <!-- FAQ Item 2 -->
                    <details class="group bg-white dark:bg-slate-800 p-6 rounded-lg cursor-pointer shadow-sm">
                        <summary class="flex justify-between items-center font-semibold text-slate-800 dark:text-slate-100 list-none">
                            Is it safe to use my personal images here?
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 transition-transform duration-300 group-open:rotate-180" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" /></svg>
                        </summary>
                        <div class="mt-4 text-slate-600 dark:text-slate-400">
                           <p>Yes, it is completely safe. Since the entire cropping process happens on your computer (client-side), your images are never uploaded to our servers. Your privacy is fully protected.</p>
                        </div>
                    </details>
                    <!-- FAQ Item 3 -->
                    <details class="group bg-white dark:bg-slate-800 p-6 rounded-lg cursor-pointer shadow-sm">
                        <summary class="flex justify-between items-center font-semibold text-slate-800 dark:text-slate-100 list-none">
                            What are aspect ratios like 16:9 or 1:1?
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 transition-transform duration-300 group-open:rotate-180" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" /></svg>
                        </summary>
                        <div class="mt-4 text-slate-600 dark:text-slate-400">
                           <p>An aspect ratio describes the proportional relationship between an image's width and its height. For example, a 1:1 ratio is a perfect square, while 16:9 is a standard widescreen format used for videos and presentations. Using these presets helps you crop your image to fit specific requirements perfectly.</p>
                        </div>
                    </details>
                    <!-- FAQ Item 4 -->
                    <details class="group bg-white dark:bg-slate-800 p-6 rounded-lg cursor-pointer shadow-sm">
                        <summary class="flex justify-between items-center font-semibold text-slate-800 dark:text-slate-100 list-none">
                            How do I download the cropped image?
                           <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 transition-transform duration-300 group-open:rotate-180" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" /></svg>
                        </summary>
                        <div class="mt-4 text-slate-600 dark:text-slate-400">
                           <p>After you are happy with the crop area, select your desired output format (JPG, PNG, or WEBP) and quality. Then, simply click the 'Crop & Download Image' button. The cropped image will be generated and downloaded directly to your computer.</p>
                        </div>
                    </details>
                </div>
            </div>
        </div>
    </section>

    <!-- =========== FOOTER =========== -->
    <footer class="bg-slate-100 dark:bg-slate-800/50 border-t border-slate-200 dark:border-slate-700/50 mt-auto">
        <div class="container mx-auto px-4 py-8">
            <div class="flex flex-col md:flex-row justify-between items-center text-center md:text-left space-y-4 md:space-y-0">
                <div>
                    <a href="/index.html" class="text-xl font-bold text-slate-900 dark:text-white">Nexa<span class="text-brand-blue">Tools</span></a>
                    <p class="text-sm text-slate-500 dark:text-slate-400">Simplifying your digital life.</p>
                </div>
                <div class="text-sm text-slate-600 dark:text-slate-400">
                    <p>contact@nexatools.pro</p>
                    <p class="mt-1">© 2025 NexaTools. All Rights Reserved.</p>
                </div>
                <div class="flex space-x-4 text-sm">
                    <a href="/privacy-policy.html" class="text-slate-600 dark:text-slate-400 hover:text-brand-blue dark:hover:text-brand-blue">Privacy Policy</a>
                    <a href="/terms-of-use.html" class="text-slate-600 dark:text-slate-400 hover:text-brand-blue dark:hover:text-brand-blue">Terms of Use</a>
                </div>
            </div>
        </div>
    </footer>

<script>
document.addEventListener('DOMContentLoaded', function() {
    
    // --- THEME & HEADER LOGIC ---
    const header = document.getElementById('header');
    const themeToggleBtn = document.getElementById('theme-toggle');
    const darkIcon = document.getElementById('theme-toggle-dark-icon');
    const lightIcon = document.getElementById('theme-toggle-light-icon');
    const toggleTheme = () => { document.documentElement.classList.toggle('dark'); localStorage.theme = document.documentElement.classList.contains('dark') ? 'dark' : 'light'; updateThemeIcons(); };
    const updateThemeIcons = () => { if (document.documentElement.classList.contains('dark')) { darkIcon.classList.remove('hidden'); lightIcon.classList.add('hidden'); } else { darkIcon.classList.add('hidden'); lightIcon.classList.remove('hidden'); } };
    themeToggleBtn.addEventListener('click', toggleTheme);
    updateThemeIcons();
    window.addEventListener('scroll', () => { header.classList.toggle('header-scrolled', window.scrollY > 10); });

    // --- IMAGE CROPPER LOGIC ---
    const uploadSection = document.getElementById('upload-section');
    const cropperSection = document.getElementById('cropper-section');
    const dropZone = document.getElementById('drop-zone');
    const fileInput = document.getElementById('file-input');
    const selectFileBtn = document.getElementById('select-file-btn');
    const imageToCrop = document.getElementById('image-to-crop');

    const aspectRatioBtns = document.getElementById('aspect-ratio-btns');
    const zoomInBtn = document.getElementById('zoom-in-btn');
    const zoomOutBtn = document.getElementById('zoom-out-btn');
    const rotateLeftBtn = document.getElementById('rotate-left-btn');
    const rotateRightBtn = document.getElementById('rotate-right-btn');
    const flipHBtn = document.getElementById('flip-h-btn');
    const flipVBtn = document.getElementById('flip-v-btn');

    const formatSelect = document.getElementById('format-select');
    const qualityControl = document.getElementById('quality-control');
    const qualitySlider = document.getElementById('quality-slider');
    const qualityValue = document.getElementById('quality-value');
    
    const cropBtn = document.getElementById('crop-btn');
    const resetBtn = document.getElementById('reset-btn');

    let cropper;
    let originalFileName = '';
    
    // --- Event Listeners ---
    selectFileBtn.addEventListener('click', () => fileInput.click());
    fileInput.addEventListener('change', (e) => handleFile(e.target.files[0]));
    dropZone.addEventListener('dragover', (e) => { e.preventDefault(); e.stopPropagation(); dropZone.classList.add('drag-over'); });
    dropZone.addEventListener('dragleave', (e) => { e.preventDefault(); e.stopPropagation(); dropZone.classList.remove('drag-over'); });
    dropZone.addEventListener('drop', (e) => { e.preventDefault(); e.stopPropagation(); dropZone.classList.remove('drag-over'); handleFile(e.dataTransfer.files[0]); });

    formatSelect.addEventListener('change', () => qualityControl.style.display = ['jpg', 'webp'].includes(formatSelect.value) ? 'block' : 'none');
    qualitySlider.addEventListener('input', () => qualityValue.textContent = qualitySlider.value);
    
    aspectRatioBtns.addEventListener('click', (e) => {
        if (e.target.tagName === 'BUTTON' && cropper) {
            cropper.setAspectRatio(parseFloat(e.target.dataset.ratio));
        }
    });

    zoomInBtn.addEventListener('click', () => cropper && cropper.zoom(0.1));
    zoomOutBtn.addEventListener('click', () => cropper && cropper.zoom(-0.1));
    rotateLeftBtn.addEventListener('click', () => cropper && cropper.rotate(-90));
    rotateRightBtn.addEventListener('click', () => cropper && cropper.rotate(90));
    flipHBtn.addEventListener('click', () => cropper && cropper.scaleX(-cropper.getData().scaleX || -1));
    flipVBtn.addEventListener('click', () => cropper && cropper.scaleY(-cropper.getData().scaleY || -1));

    cropBtn.addEventListener('click', cropAndDownload);
    resetBtn.addEventListener('click', resetTool);


    function handleFile(file) {
        if (!file || !file.type.startsWith('image/')) {
            alert('Please select an image file.');
            return;
        }

        originalFileName = file.name;
        const reader = new FileReader();
        reader.onload = (e) => {
            imageToCrop.src = e.target.result;
            uploadSection.classList.add('hidden');
            cropperSection.classList.remove('hidden');
            initializeCropper();
        };
        reader.readAsDataURL(file);
    }
    
    function initializeCropper() {
        if (cropper) {
            cropper.destroy();
        }
        cropper = new Cropper(imageToCrop, {
            preview: '.preview-box',
            viewMode: 1,
            dragMode: 'move',
            autoCropArea: 0.8,
            responsive: true,
            restore: false,
            guides: false,
            center: false,
            highlight: false,
            cropBoxMovable: true,
            cropBoxResizable: true,
            toggleDragModeOnDblclick: false,
        });
    }

    function cropAndDownload() {
        if (!cropper) return;
        
        const format = formatSelect.value;
        const quality = qualitySlider.value / 100;
        const mimeType = `image/${format === 'jpg' ? 'jpeg' : format}`;
        
        const croppedCanvas = cropper.getCroppedCanvas();
        
        // Fill background for JPG if the original was transparent PNG
        if (format === 'jpg') {
            const canvas = document.createElement('canvas');
            canvas.width = croppedCanvas.width;
            canvas.height = croppedCanvas.height;
            const ctx = canvas.getContext('2d');
            ctx.fillStyle = '#FFFFFF';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.drawImage(croppedCanvas, 0, 0);
            
            canvas.toBlob((blob) => downloadBlob(blob, format), mimeType, quality);
        } else {
            croppedCanvas.toBlob((blob) => downloadBlob(blob, format), mimeType, quality);
        }
    }

    function downloadBlob(blob, format) {
        const link = document.createElement('a');
        link.href = URL.createObjectURL(blob);
        
        const nameWithoutExt = originalFileName.substring(0, originalFileName.lastIndexOf('.'));
        link.download = `${nameWithoutExt}-cropped.${format}`;
        
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    }

    function resetTool() {
        if (cropper) {
            cropper.destroy();
            cropper = null;
        }
        imageToCrop.src = '';
        fileInput.value = ''; // Reset file input
        uploadSection.classList.remove('hidden');
        cropperSection.classList.add('hidden');
    }

});
</script>

</body>
</html>