<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- ================= SEO Meta Tags ================= -->
    <title>Free PDF Compressor - Reduce PDF File Size Online | NexaTools</title>
    <meta name="description" content="Reduce the file size of your PDF documents for free with NexaTools' online PDF compressor. Fast, secure, and entirely in your browser. No uploads required.">
    <meta name="keywords" content="pdf compressor, reduce pdf size, compress pdf, optimize pdf, free pdf compressor, online pdf compressor, nexatools">
    <link rel="canonical" href="https://www.nexatools.pro/pdf-compressor">

    <!-- ================= Favicon ================= -->
    <link rel="apple-touch-icon" sizes="180x180" href="/assets/favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon/favicon-16x16.png">
    <link rel="manifest" href="/assets/favicon/site.webmanifest">
    <link rel="shortcut icon" href="/assets/favicon/favicon.ico">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-config" content="/assets/favicon/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">

    <!-- ================= Open Graph / Facebook Meta Tags ================= -->
    <meta property="og:title" content="Free PDF Compressor - Reduce PDF File Size Online | NexaTools">
    <meta property="og:description" content="Reduce the file size of your PDF documents for free with NexaTools' online PDF compressor. Fast, secure, and entirely in your browser.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://www.nexatools.pro/pdf-compressor">
    <meta property="og:image" content="https://www.nexatools.pro/assets/images/og-image-pdf-compressor.png"> <!-- Use an absolute URL for your OG image -->

    <!-- ================= Twitter Card Meta Tags ================= -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Free PDF Compressor - Reduce PDF File Size Online | NexaTools">
    <meta name="twitter:description" content="Reduce the file size of your PDF documents for free with NexaTools' online PDF compressor. Fast, secure, and entirely in your browser.">
    <meta name="twitter:image" content="https://www.nexatools.pro/assets/images/twitter-image-pdf-compressor.png"> <!-- Use an absolute URL for your Twitter image -->

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Styles -->
    <style>
        .header-scrolled {
            background-color: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        }
        .dark .header-scrolled {
            background-color: rgba(15, 23, 42, 0.8);
        }
        .drag-over {
            border-color: #10b981; /* brand-green */
            background-color: rgb(16 185 129 / 0.05);
        }
        .dark .drag-over {
            background-color: rgb(16 185 129 / 0.1);
        }
        /* Style for the file info display */
        .file-info-display {
            background-color: white;
            padding: 2rem;
            text-align: center;
        }
        .dark .file-info-display {
             background-color: #f1f5f9; /* slate-100 for better readability */
             color: #1e293b; /* slate-800 */
        }
        .file-info-display p { font-size: 1.125rem; margin-bottom: 0.75rem; }
        .file-info-display .label { font-weight: 600; color: #475569; }
        .dark .file-info-display .label { color: #334155; }
        .file-info-display .value { font-weight: 700; color: #1e293b; }
        .dark .file-info-display .value { color: #0f172a; }
        .file-info-display .reduction { color: #10b981; }
        /* Style for FAQ accordion */
        details > summary { list-style: none; }
        details > summary::-webkit-details-marker { display: none; }
        details[open] summary .faq-arrow { transform: rotate(180deg); }
    </style>

    <!-- Theme Logic -->
    <script>
        if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark')
        } else {
            document.documentElement.classList.remove('dark')
        }
        tailwind.config = { darkMode: 'class', theme: { extend: { colors: { brand: { blue: '#3b82f6', green: '#10b981' } } } } }
    </script>
    
    <!-- ================= JSON-LD Schema Markup ================= -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@graph": [
        {
          "@type": "SoftwareApplication",
          "name": "PDF Compressor",
          "operatingSystem": "Any (Web-based)",
          "applicationCategory": "UtilitiesApplication",
          "aggregateRating": {
            "@type": "AggregateRating",
            "ratingValue": "4.9",
            "ratingCount": "3450"
          },
          "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "USD"
          },
          "description": "A free online utility to reduce the file size of PDF documents by optimizing their internal structure and removing redundant data. All processing is done securely in the user's browser.",
          "url": "https://www.nexatools.pro/pdf-compressor",
          "publisher": {
            "@type": "Organization",
            "name": "NexaTools",
            "url": "https://www.nexatools.pro"
          }
        },
        {
          "@type": "FAQPage",
          "mainEntity": [
            {
              "@type": "Question",
              "name": "Is this PDF compressor tool free to use?",
              "acceptedAnswer": {
                "@type": "Answer",
                "text": "Yes, our PDF compressor is 100% free to use with no limitations or watermarks on the output file."
              }
            },
            {
              "@type": "Question",
              "name": "Are my files uploaded to your servers for compression?",
              "acceptedAnswer": {
                "@type": "Answer",
                "text": "No. For your complete privacy and security, our PDF compressor works entirely within your web browser. Your files are never uploaded to any server and remain on your computer at all times."
              }
            },
            {
              "@type": "Question",
              "name": "How does the compression work without losing quality?",
              "acceptedAnswer": {
                "@type": "Answer",
                "text": "This tool works by reorganizing the internal structure of the PDF and removing redundant or unused data objects. For most standard PDFs, this significantly reduces the file size without any visible change to the content's quality."
              }
            },
            {
              "@type": "Question",
              "name": "Will this work on encrypted or password-protected PDFs?",
              "acceptedAnswer": {
                "@type": "Answer",
                "text": "No, this client-side tool cannot process encrypted or password-protected PDF files. You will need to remove the protection before you can compress the file."
              }
            }
          ]
        }
      ]
    }
    </script>
</head>
<body class="bg-slate-50 dark:bg-slate-900 text-slate-800 dark:text-slate-200 transition-colors duration-300 flex flex-col min-h-screen">

    <!-- =========== HEADER (NexaTools Design) =========== -->
    <header id="header" class="fixed top-0 left-0 right-0 z-50 transition-all duration-300">
        <div class="container mx-auto px-4 py-4 flex justify-between items-center">
            <a href="/index.html" class="text-2xl font-bold text-slate-900 dark:text-white">Nexa<span class="text-brand-blue">Tools</span></a>
            <nav class="hidden md:flex items-center space-x-8">
                <a href="/index.html" class="text-slate-600 dark:text-slate-300 hover:text-brand-blue dark:hover:text-brand-blue">Home</a>
                <a href="/index.html#tools" class="text-brand-green font-semibold">Tools</a>
                <a href="/about-us.html" class="text-slate-600 dark:text-slate-300 hover:text-brand-blue dark:hover:text-brand-blue">About</a>
                <a href="/contact-us.html" class="text-slate-600 dark:text-slate-300 hover:text-brand-blue dark:hover:text-brand-blue">Contact</a>
            </nav>
            <div class="flex items-center">
                <button id="theme-toggle" class="p-2 rounded-full hover:bg-slate-200 dark:hover:bg-slate-700">
                    <svg id="theme-toggle-dark-icon" class="hidden h-5 w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg>
                    <svg id="theme-toggle-light-icon" class="hidden h-5 w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 5.05A1 1 0 003.636 6.464l.707.707a1 1 0 001.414-1.414l-.707-.707zM3 11a1 1 0 100-2H2a1 1 0 100 2h1zM6.464 16.364l.707-.707a1 1 0 00-1.414-1.414l-.707.707a1 1 0 001.414 1.414z" fill-rule="evenodd" clip-rule="evenodd"></path></svg>
                </button>
            </div>
        </div>
    </header>

    <main class="flex-grow pt-24 pb-12">
        <div class="container mx-auto px-4">
            <!-- Tool Header -->
            <div class="text-center mb-12">
                <h1 class="text-4xl md:text-5xl font-extrabold text-slate-900 dark:text-white flex items-center justify-center gap-4">
                    <span class="text-brand-green">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-12 h-12"><path stroke-linecap="round" stroke-linejoin="round" d="M9 9V4.5M9 9H4.5M9 9L3.75 3.75M9 15v4.5M9 15H4.5M9 15l-5.25 5.25M15 9h4.5M15 9V4.5M15 9l5.25-5.25M15 15h4.5M15 15v4.5M15 15l5.25 5.25" /></svg>
                    </span>
                    PDF Compressor
                </h1>
                <p class="mt-4 text-lg md:text-xl max-w-2xl mx-auto text-slate-600 dark:text-slate-300">Reduce the file size of your PDF documents quickly and easily.</p>
            </div>
            
            <div class="max-w-4xl mx-auto bg-white dark:bg-slate-800 rounded-xl shadow-lg p-6 md:p-8">
                
                <!-- Loading State -->
                <div id="loading-state" class="text-center p-8">
                    <svg class="animate-spin h-8 w-8 mx-auto text-brand-green" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>
                    <p class="mt-4 font-semibold text-slate-600 dark:text-slate-300">Loading compression engine...</p>
                </div>

                <!-- Error State -->
                <div id="error-state" class="hidden text-center p-8 bg-red-100 dark:bg-red-900/50 rounded-lg">
                    <p class="font-bold text-red-700 dark:text-red-300">Failed to load compression engine.</p>
                    <p class="mt-2 text-red-600 dark:text-red-400">Please check your internet connection and refresh the page.</p>
                </div>

                <!-- Upload Area (initially hidden) -->
                <div id="upload-section" class="hidden">
                    <div id="drop-zone" class="border-2 border-dashed border-slate-300 dark:border-slate-600 rounded-lg p-8 text-center cursor-pointer transition-all duration-300">
                        <div class="flex flex-col items-center justify-center space-y-4 text-slate-500 dark:text-slate-400">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1"><path stroke-linecap="round" stroke-linejoin="round" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" /></svg>
                            <p class="text-lg font-semibold">Drag & drop a PDF file here</p>
                            <p>or</p>
                            <button id="select-files-btn" class="bg-brand-green text-white font-bold py-2 px-6 rounded-lg shadow-md hover:bg-green-600 transition-colors">Select .pdf File</button>
                            <input type="file" id="file-input" class="hidden" accept=".pdf,application/pdf">
                        </div>
                    </div>
                </div>

                <!-- Processing UI -->
                <div id="processing-section" class="hidden">
                    <div class="bg-slate-100 dark:bg-slate-700/50 p-4 rounded-lg">
                        <p id="file-name" class="font-bold text-slate-800 dark:text-slate-100 truncate"></p>
                    </div>

                    <div class="mt-4 border rounded-lg overflow-hidden h-48 flex items-center justify-center bg-slate-200 dark:bg-slate-700 p-2">
                        <div id="file-info" class="file-info-display">
                            <!-- Info will be populated by JS -->
                        </div>
                    </div>
                    
                    <div class="mt-8">
                        <button id="action-btn" class="w-full bg-brand-green text-white font-bold py-3 px-6 rounded-lg shadow-md hover:bg-green-600 flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed">
                           Compress PDF
                        </button>
                        <button id="reset-btn" class="mt-4 w-full bg-slate-500 text-white font-semibold py-2 px-6 rounded-lg hover:bg-slate-600 transition-colors">
                            Use Another File
                        </button>
                    </div>
                </div>
            </div>

            <!-- ================= FAQ Section ================= -->
            <section class="max-w-4xl mx-auto mt-16">
                <h2 class="text-3xl font-bold text-center mb-8 text-slate-900 dark:text-white">Frequently Asked Questions</h2>
                <div class="space-y-4">
                    <!-- FAQ Item 1 -->
                    <details class="group bg-white dark:bg-slate-800 p-6 rounded-lg shadow-md">
                        <summary class="flex items-center justify-between cursor-pointer font-semibold text-slate-800 dark:text-slate-100">
                            Is this PDF compressor tool free to use?
                            <span class="faq-arrow transition-transform duration-300">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" /></svg>
                            </span>
                        </summary>
                        <p class="mt-4 text-slate-600 dark:text-slate-300">Yes, our PDF compressor is 100% free to use with no limitations or watermarks on the output file.</p>
                    </details>
                    <!-- FAQ Item 2 -->
                    <details class="group bg-white dark:bg-slate-800 p-6 rounded-lg shadow-md">
                        <summary class="flex items-center justify-between cursor-pointer font-semibold text-slate-800 dark:text-slate-100">
                            Are my files uploaded to your servers for compression?
                            <span class="faq-arrow transition-transform duration-300">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" /></svg>
                            </span>
                        </summary>
                        <p class="mt-4 text-slate-600 dark:text-slate-300">No. For your complete privacy and security, our PDF compressor works entirely within your web browser. Your files are never uploaded to any server and remain on your computer at all times.</p>
                    </details>
                    <!-- FAQ Item 3 -->
                    <details class="group bg-white dark:bg-slate-800 p-6 rounded-lg shadow-md">
                        <summary class="flex items-center justify-between cursor-pointer font-semibold text-slate-800 dark:text-slate-100">
                           How does the compression work without losing quality?
                            <span class="faq-arrow transition-transform duration-300">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" /></svg>
                            </span>
                        </summary>
                        <p class="mt-4 text-slate-600 dark:text-slate-300">This tool works by reorganizing the internal structure of the PDF and removing redundant or unused data objects. For most standard PDFs, this significantly reduces the file size without any visible change to the content's quality.</p>
                    </details>
                     <!-- FAQ Item 4 -->
                    <details class="group bg-white dark:bg-slate-800 p-6 rounded-lg shadow-md">
                        <summary class="flex items-center justify-between cursor-pointer font-semibold text-slate-800 dark:text-slate-100">
                           Will this work on encrypted or password-protected PDFs?
                            <span class="faq-arrow transition-transform duration-300">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" /></svg>
                            </span>
                        </summary>
                        <p class="mt-4 text-slate-600 dark:text-slate-300">No, this client-side tool cannot process encrypted or password-protected PDF files. You will need to remove the protection before you can compress the file.</p>
                    </details>
                </div>
            </section>
        </div>
    </main>

    <!-- =========== FOOTER (NexaTools Design) =========== -->
    <footer class="bg-slate-100 dark:bg-slate-800/50 border-t border-slate-200 dark:border-slate-700/50 mt-auto">
        <div class="container mx-auto px-4 py-8">
            <div class="flex flex-col md:flex-row justify-between items-center text-center md:text-left space-y-4 md:space-y-0">
                <div>
                    <a href="/index.html" class="text-xl font-bold text-slate-900 dark:text-white">Nexa<span class="text-brand-blue">Tools</span></a>
                    <p class="text-sm text-slate-500 dark:text-slate-400">Simplifying your digital life.</p>
                </div>
                <div class="text-sm text-slate-600 dark:text-slate-400">
                    <p>contact@nexatools.pro</p>
                    <p class="mt-1">© 2025 NexaTools. All Rights Reserved.</p>
                </div>
                <div class="flex space-x-4 text-sm">
                    <a href="/privacy-policy.html" class="text-slate-600 dark:text-slate-400 hover:text-brand-blue dark:hover:text-brand-blue">Privacy Policy</a>
                    <a href="/terms-of-use.html" class="text-slate-600 dark:text-slate-400 hover:text-brand-blue dark:hover:text-brand-blue">Terms of Use</a>
                </div>
            </div>
        </div>
    </footer>

    <!-- External Libraries -->
    <script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            
            // UI Elements
            const themeToggleBtn = document.getElementById('theme-toggle');
            const loadingState = document.getElementById('loading-state');
            const errorState = document.getElementById('error-state');
            const uploadSection = document.getElementById('upload-section');
            const dropZone = document.getElementById('drop-zone');
            const fileInput = document.getElementById('file-input');
            const selectFilesBtn = document.getElementById('select-files-btn');
            const processingSection = document.getElementById('processing-section');
            const fileInfoEl = document.getElementById('file-info');
            const fileNameEl = document.getElementById('file-name');
            const actionBtn = document.getElementById('action-btn');
            const resetBtn = document.getElementById('reset-btn');

            let uploadedFile = null;
            let compressedPdfBlob = null;

            // --- THEME & HEADER ---
            const toggleTheme = () => { 
                document.documentElement.classList.toggle('dark');
                localStorage.theme = document.documentElement.classList.contains('dark') ? 'dark' : 'light';
                updateThemeIcons();
            };
            const updateThemeIcons = () => {
                const isDark = document.documentElement.classList.contains('dark');
                if (themeToggleBtn) { // Check if the button exists
                    document.getElementById('theme-toggle-dark-icon').classList.toggle('hidden', !isDark);
                    document.getElementById('theme-toggle-light-icon').classList.toggle('hidden', isDark);
                }
            };
            const handleHeaderScroll = () => {
                const header = document.getElementById('header');
                if (header) {
                    window.scrollY > 10 ? header.classList.add('header-scrolled') : header.classList.remove('header-scrolled');
                }
            };
            window.addEventListener('scroll', handleHeaderScroll);

            // --- ROBUST LIBRARY INITIALIZATION ---
            const initializeTool = () => {
                let attempts = 0;
                const maxAttempts = 50; // 10 seconds timeout
                
                const checkLibraries = setInterval(() => {
                    if (typeof window.PDFLib !== 'undefined') {
                        clearInterval(checkLibraries);
                        loadingState.classList.add('hidden');
                        uploadSection.classList.remove('hidden');
                        setupEventListeners();
                    } else {
                        attempts++;
                        if (attempts > maxAttempts) {
                            clearInterval(checkLibraries);
                            loadingState.classList.add('hidden');
                            errorState.classList.remove('hidden');
                        }
                    }
                }, 200);
            };

            // --- FILE HANDLING ---
            const handleFile = (file) => {
                if (!file || !file.type.includes('pdf')) {
                    alert('Please select a valid .pdf file.');
                    return;
                }
                
                resetTool(false); 
                uploadedFile = file;

                uploadSection.classList.add('hidden');
                processingSection.classList.remove('hidden');
                fileNameEl.textContent = file.name;
                
                // Display initial file info
                fileInfoEl.innerHTML = `<p><span class="label">Original Size:</span> <span class="value">${formatBytes(file.size)}</span></p>`;
                actionBtn.disabled = false;
            };
            
            // --- COMPRESSION LOGIC ---
            const onActionClick = async () => {
                if (compressedPdfBlob) {
                    downloadFile();
                } else {
                    await compressPdf();
                }
            };

            const compressPdf = async () => {
                if (!uploadedFile) return;

                actionBtn.disabled = true;
                actionBtn.innerHTML = `<svg class="animate-spin h-5 w-5 mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg> Compressing...`;

                try {
                    const { PDFDocument } = window.PDFLib;
                    const existingPdfBytes = await uploadedFile.arrayBuffer();
                    const pdfDoc = await PDFDocument.load(existingPdfBytes, { 
                        updateMetadata: false 
                    });
                    
                    const pdfBytes = await pdfDoc.save();
                    
                    compressedPdfBlob = new Blob([pdfBytes], { type: 'application/pdf' });
                    
                    // Update UI with results
                    const originalSize = uploadedFile.size;
                    const newSize = compressedPdfBlob.size;
                    const reduction = originalSize > 0 ? Math.round(((originalSize - newSize) / originalSize) * 100) : 0;

                    fileInfoEl.innerHTML = `
                        <p><span class="label">Original Size:</span> <span class="value">${formatBytes(originalSize)}</span></p>
                        <p><span class="label">New Size:</span> <span class="value">${formatBytes(newSize)}</span></p>
                        <p><span class="label">Reduction:</span> <span class="value reduction">${reduction}%</span></p>
                    `;
                    
                    actionBtn.textContent = 'Download Compressed PDF';
                    actionBtn.classList.replace('bg-brand-green', 'bg-brand-blue');
                    actionBtn.classList.replace('hover:bg-green-600', 'hover:bg-blue-600');

                } catch (error) {
                    handleError(error, "Compression failed");
                } finally {
                    actionBtn.disabled = false;
                }
            };
            
            // --- UTILITY FUNCTIONS ---
            const formatBytes = (bytes, decimals = 2) => {
                if (!+bytes) return '0 Bytes';
                const k = 1024;
                const dm = decimals < 0 ? 0 : decimals;
                const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                return `${parseFloat((bytes / Math.pow(k, i)).toFixed(dm))} ${sizes[i]}`;
            };
            
            const downloadFile = () => {
                if (!compressedPdfBlob) return;
                const originalName = uploadedFile.name.substring(0, uploadedFile.name.lastIndexOf('.'));
                const newFileName = `${originalName}-compressed.pdf`;
                const link = document.createElement('a');
                link.href = URL.createObjectURL(compressedPdfBlob);
                link.download = newFileName;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(link.href);
            };

            const handleError = (error, message) => {
                console.error(message, error);
                alert(`${message}. The PDF might be encrypted, corrupted, or too complex for client-side processing.`);
                actionBtn.textContent = 'Compression Failed';
                actionBtn.classList.replace('bg-brand-green', 'bg-red-500');
                actionBtn.disabled = false;
            };
            
            const resetTool = (showUpload = true) => {
                uploadedFile = null;
                compressedPdfBlob = null;
                fileInput.value = '';
                fileInfoEl.innerHTML = '';
                if (showUpload) {
                    uploadSection.classList.remove('hidden');
                    processingSection.classList.add('hidden');
                }
                actionBtn.disabled = true;
                actionBtn.innerHTML = 'Compress PDF';
                actionBtn.classList.replace('bg-brand-blue', 'bg-brand-green');
                actionBtn.classList.replace('hover:bg-blue-600', 'hover:bg-green-600');
                actionBtn.classList.remove('bg-red-500', 'hover:bg-red-600');
            };

            // --- EVENT LISTENERS ---
            const setupEventListeners = () => {
                if(themeToggleBtn) themeToggleBtn.addEventListener('click', toggleTheme);
                selectFilesBtn.addEventListener('click', () => fileInput.click()); 
                fileInput.addEventListener('change', (e) => handleFile(e.target.files[0]));
                dropZone.addEventListener('dragover', (e) => { e.preventDefault(); e.stopPropagation(); dropZone.classList.add('drag-over'); });
                dropZone.addEventListener('dragleave', (e) => { e.preventDefault(); e.stopPropagation(); dropZone.classList.remove('drag-over'); });
                dropZone.addEventListener('drop', (e) => { e.preventDefault(); e.stopPropagation(); dropZone.classList.remove('drag-over'); handleFile(e.dataTransfer.files[0]); });
                actionBtn.addEventListener('click', onActionClick);
                resetBtn.addEventListener('click', () => resetTool(true));
            };
            
            // --- INITIALIZATION ---
            updateThemeIcons();
            initializeTool();
        });
    </script>
</body>
</html>